import Tag from '../../src/components/Tag'

# åœ¨å‰ç«¯é¡¹ç›®ä¸­ä½¿ç”¨webpackçš„ç¯å¢ƒå˜é‡
<Tag tag='webpack'  />
æœ€è¿‘åœ¨æŠ˜è…¾é¡¹ç›®ä¸­ï¼Œæœ‰æ—¶å€™ä¼šéœ€è¦åœ¨å‰ç«¯é¡¹ç›®ä¸­ä½¿ç”¨ç¯å¢ƒå˜é‡ï¼Œæ¯”å¦‚åœ¨`webpack.prod.js`æˆ–è€…`webpack.dev.js`ä¸­ä½¿ç”¨ã€‚æ‰¾äº†ä¸€äº›è§£å†³åŠæ³•ï¼Œæœ€åæœ‰äº†è¿™ç¯‡æ–‡ç« ã€‚
## å®šä¹‰ç¯å¢ƒå˜é‡
### åœ¨æ ¹ç›®å½•ä¸‹åˆ›å»º.envæ–‡ä»¶
`base.env`
```env
#åŸºç¡€é…ç½®ï¼Œä¸ç®¡å¼€å‘æˆ–è€…æµ‹è¯•ç¯å¢ƒéƒ½ç”¨å¾—åˆ°,ä½¿ç”¨CUSTOMIZEå‰ç¼€ï¼Œå’Œnodeçš„ç¯å¢ƒå˜é‡åŒºåˆ†
CUSTOMIZE_APP_TITLE=ä¸€ä¸ªç³»ç»Ÿ
```
`dev.env`
```env
#æµ‹è¯•å¼€å‘ç¯å¢ƒä¿¡æ¯
CUSTOMIZE_PORT=8081
CUSTOMIZE_SERVER_URL='http://localhost:8000'
CUSTOMIZE_MODE='development'
```
`prod.env`
```env
#æ­£å¼ç¯å¢ƒä¿¡æ¯
CUSTOMIZE_MODE='production'
CUSTOMIZE_PORT=80
CUSTOMIZE_SERVER_URL='~api'
```
###  ä½¿ç”¨ç¯å¢ƒå˜é‡
#### åœ¨webpackä¸­ä½¿ç”¨
ä½¿ç”¨`dotenv`æ’ä»¶ç›´æ¥å¸®æˆ‘ä»¬åŠ å…¥å˜é‡åˆ°`process.env`,åŒæ—¶å¯ä»¥å¼•å…¥å¤šä¸ªï¼Œå¹¶ä¸”å¯ä»¥è¦†ç›–ï¼Œè¯¦ç»†æ–‡æ¡£[dotenv](https://github.com/motdotla/dotenv)
```js
    // webpack.prod.js or webpack.dev.js
    // çœç•¥äº›ä»£ç 
    const dotenv = require('dotenv');// å¼•å…¥æ’ä»¶
    dotenv.config({ path: ['dev.env', 'base.env'], override: true });// åŠ è½½.envæ–‡ä»¶,å¹¶ä¸”è¦†ç›–,
    console.log(process.env.CUSTOMIZE_APP_TITLE);// ä¸€ä¸ªç³»ç»Ÿ
    // çœç•¥äº›ä»£ç 
```
#### åœ¨å‰ç«¯é¡µé¢ä¸­ä½¿ç”¨
ç›¸å¯¹ç›´æ¥åœ¨webpackä¸­ä½¿ç”¨ï¼Œæˆ‘ä»¬è¦ä¿è¯é¡µé¢ç¼–è¯‘é€šè¿‡;å°±éœ€è¦ä½¿ç”¨åˆ°`webpack.DefinePlugin`,ä¸€ä¸ªæ’ä»¶æŠŠå˜é‡æ³¨å…¥åˆ°å…¨å±€;
##### `dotenv.config()`ä¼šè¿”å›ä¸€ä¸ªå¤„ç†å¥½çš„å¯¹è±¡
```js
// çœç•¥äº›ä»£ç 
 const _dotenv = dotenv.config({ path: ['dev.env', 'base.env'], override: true })
 console.log(_dotenv)
 // çœç•¥äº›ä»£ç 
 /*{
    parse:{ CUSTOMIZE_APP_TITLE: 'ä¸€ä¸ªç³»ç»Ÿ', CUSTOMIZE_MODE: 'development', CUSTOMIZE_PORT: '8081', CUSTOMIZE_SERVER_URL: 'http://localhost:8000' }
 }*/
```
##### `webpack.DefinePlugin`[ä½¿ç”¨æ–¹å¼](https://webpack.js.org/plugins/define-plugin/)
`webpack.dev.js` é‡Œé…ç½®
```js
// çœç•¥äº›ä»£ç 
module.exports = {
  plugins: [
    new webpack.DefinePlugin({
      'process.env.CUSTOMIZE_MODE': JSON.stringify('CUSTOMIZE_MODE')
    })
  ]
}
// çœç•¥äº›ä»£ç 
```
åœ¨é¡µé¢ä¸­ä½¿ç”¨
```js
baseURL: process.env.CUSTOMIZE_MODE === 'production' ? process.env.CUSTOMIZE_SERVER_URL : '/api',
```
##### æ€»ç»“ä¸€ä¸‹é¡µé¢ä½¿ç”¨
é…ç½®
```js
 // webpack.prod.js or webpack.dev.js
    // çœç•¥
    const dotenv = require('dotenv');// å¼•å…¥æ’ä»¶
    const _dotenv = dotenv.config({ path: ['dev.env', 'base.env'], override: true });// åŠ è½½.envæ–‡ä»¶,å¹¶ä¸”è¦†ç›–,
    console.log(process.env.CUSTOMIZE_APP_TITLE);// ä¸€ä¸ªç³»ç»Ÿ
    module.exports = {
        plugins: [
            new webpack.DefinePlugin(generateEnv(_dotenv.parse))
        ]
    }
    /**
     * æ ¹æ®æä¾›çš„è§£ææ•°æ®ç”Ÿæˆç¯å¢ƒå¯¹è±¡ã€‚
     *
     * @param {Object} parsed - è§£ææ•°æ®å¯¹è±¡ã€‚
     * @return {Object} ç”Ÿæˆçš„ç¯å¢ƒå¯¹è±¡ã€‚
     */
    function generateEnv(parsed) {
        const env = {};
        Object.keys(parsed).forEach(key => {
            const value = parsed[key];
            if (value && value !== null) {
                env[`process.env.${key}`] = JSON.stringify(value);
            }
        });
        return env;
    }
    // çœç•¥äº›ä»£ç 
```
ä½¿ç”¨
```tsx
import { FC } from 'react';
import { Outlet } from 'react-router-dom';
import './index.scss';

const User: FC = () => {
	return (
		<div className="user-main">
			<div className="user-container">
				<div className="title">{process.env.CUSTOMIZE_APP_TITLE}</div>
				<Outlet />
			</div>
		</div>
	);
};
export default User;
```
***æ³¨æ„ï¼šå¦‚æœä½¿ç”¨äº†tsï¼Œå¯èƒ½ä¼šå‡ºç°æŠ¥é”™ `process is not defined`***
å®šä¹‰ä¸€ä¸‹å…¨å±€tsç±»å‹
```ts
declare const process: {
	env: {
		[key: string]: string;
	};
	[key: string]: unknown;
};
```
---
è°¢è°¢è§‚çœ‹ğŸ™‚ï¸